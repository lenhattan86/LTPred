function [y1,xf1] = ann_ntstool(x1,xi1)
%ann_ntstool neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 14-Jul-2015 14:52:23.
% 
% [y1,xf1] = ann_ntstool(x1,xi1) takes these arguments:
%   x = 1xTS matrix, input #1
%   xi1 = 1x72 matrix, initial 72 delay states for input #1.
% and returns:
%   y = 1xTS matrix, output #1
%   xf1 = 1x72 matrix, final 72 delay states for input #1.
% where TS is the number of timesteps.

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = 0;
  x1_step1_gain = 0.0832466181061394;
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [3.9859497217286237;-3.1275994183967128;-1.3304806442090646;-3.3105877317111641;1.4247794897455066;0.1020111836379077;-0.06101751207062972;-2.57678389540974;3.7607004625827827;-3.8370404604028958];
  IW1_1 = [6.0430819043272992 4.0203512308831773 2.0667415122201196 -0.96282405403958582 -0.61906965164207461 2.9203315679351389 1.4630573548644727 -2.4299316536524609 -1.3877819059852854 -0.67842169456600232 -1.4851547790017205 0.28219308159136924 1.2448858658411135 0.21920566985343326 -2.1782239164387391 0.39022050715483558 3.0564491907067119 0.94592012131929315 -3.0683918126389664 -0.52337872199384106 0.57515855100761781 1.8317920199641438 1.3760187439327483 0.36056999197925876 0.57102380874287384 1.0153658052782919 3.1027000211432778 2.5203922240510552 2.1876817601651117 2.393156779339034 -0.086562463547448565 1.535091022350576 1.396860413662544 0.39862184014639374 -0.054900467436376388 -1.2965845222737422 -0.1712799899689984 2.4083867480865573 0.10535365321703255 -1.157506350724639 0.0048489218139969315 -1.4362486707970259 0.7362220691964414 -2.6643652253814807 2.9245272150109347 0.88287459066292839 0.29484626825813437 0.2306698074274206 -0.064187265406452504 -2.3539624760754836 -5.3454319390077663 0.0056846996115590132 -4.5739524753345151 -0.18673966228481215 -2.1578745431691462 -1.2170528862748902 0.96661458720402149 0.71849075480855262 -1.3213498255267861 -0.97325326279566493 -0.54338313562596441 0.84815305200860214 -0.6427523687798754 -0.7912115284233443 4.1781310998746157 0.10829824094063753 0.48667882813970498 -3.2008395681823969 0.30313774172039992 0.74882582759400718 -1.2175672884611894 -5.4162214231203487;3.2615652897563732 -3.9468196732889709 4.1633888799466598 -4.1372302433925521 1.2058259723281184 0.82680800105443863 -1.344758836621796 -1.3643395000338383 2.0910206379563188 -0.37213200277861402 1.317441653470578 -1.893116009067551 1.1073880333587407 -2.3023625542260908 0.59236949616964452 0.69866837793258374 -0.14996727072306637 0.90284859927416339 -1.3887008858339693 0.55980454791368583 -0.40641001141723865 -0.71651124819400114 0.79445369688160195 -0.51790272327081044 1.120831302942022 -0.31538791967691548 0.78020465577825537 1.0399067683543315 -2.2676851995545118 -1.0087532128373904 1.3259319109767642 -0.8637109455835722 2.1628542874749619 -3.2645121512400608 1.8573301482564026 0.19531045499031802 0.12457134618750376 -1.4630721358822536 2.1802010363937172 -0.26846667405169011 -1.6196493419029172 -0.0045926968431997395 2.8393219406023285 -1.9919188680596425 -0.77251761164813249 -0.72667812805455334 5.99480058786206 -3.6787774027927549 -0.68412614830793483 -0.91036300359745614 0.99573767540273073 1.053433754207987 1.8366679200896816 -2.8270318456125816 1.1593625125569291 0.2682678719509114 -0.59847725014218456 0.20357820705987212 0.66263961354522705 -0.95455284108430094 -0.88341321312941545 -0.25498070381484217 1.68853862295075 -1.817618600849259 -3.8587273103243658 2.1258375519703225 3.5893105388164286 -7.0320090679290619 6.7071162606144599 -3.4891723323407824 2.1767634553630852 -1.5324991985401615;7.5485016782229808 -6.0790760380458249 4.2197324900007898 0.012883203155095127 -0.12666775866866981 2.2694649619294096 -1.2863860290758689 0.46632266557436969 -0.24157211859578476 -1.1466222902470209 -0.4728917215500581 1.0805193730608744 0.83588710890932005 -1.4506536095310616 1.7520039160548049 0.19881257992144852 -2.26240476516766 1.2569772653515834 -0.95512609262738635 0.52341606248541328 -0.49779961955483587 1.236667390062208 1.1216897829736419 -2.5572217087001574 0.084155911317168985 -0.93036367068499071 -1.5071660019822677 -0.22482261765166192 -3.7058286909141609 2.9422650349830635 -0.13906252612983411 -0.079700381588221902 0.26075478022572374 0.23373353391753593 -1.7642758570563053 2.6640797593222811 0.00072246424537597553 -0.23181612893703191 0.70159888331583975 0.35072350729797364 -2.8794486235889507 2.6926969841308344 -0.3587019827560704 -0.32481200311561348 -0.76570754685355158 0.25021643125069004 0.35337684779814676 -2.5483872131310146 -0.021127864152984399 2.2539340669621071 -2.1197795108624922 -0.89796539116199203 -1.1102247129403313 -3.2341774507707024 0.96827185445582586 2.1027282040464494 1.2297853141757751 -0.88097108570512273 -0.73844422954107236 0.1882591808466412 0.53358606485738647 -0.81434178738183771 1.6370114995819272 -0.40898484591153833 -0.90195878562893839 -1.707070186905153 2.4767184001394771 0.01203789470790706 1.9660321055995917 -2.1230056194416727 1.4234083364294117 -0.38279185690760442;0.72564275983345927 -0.33789187422735267 0.80634932657202829 -4.0030266402012078 -1.5085681910683029 -1.0639793687823456 0.6706853802219932 1.11916167688684 1.5687988988414165 0.097381044168212222 0.60881216999207033 -2.0880434171600482 -1.6908022043987625 1.2170954665921681 -0.22107743696359039 0.65580514443200255 -1.1252717077111347 -1.2963376260780826 2.5957183859707493 0.81099567253231608 -0.13141636593100192 -2.7620349727875433 -4.7993724181621857 -2.8599457293850645 -0.60011994491493525 -0.98181874824549564 -0.98521861966886104 -2.4373799875896318 2.3808326500856256 0.080060906027470236 0.49479970093687292 -0.70637664528451272 -2.881919018737928 -0.78374396424334813 0.15228177117649144 1.0685885647103148 0.39431867722372671 3.0304008410751018 0.22121161930506922 0.41392062688531089 -1.1206646117351771 -3.5755238620675254 0.23926602089891835 1.5105600308980478 1.8604243289774351 -0.67583599536620342 -0.86550293719551497 3.8116714545832919 0.18404573678704556 4.3501715039765436 5.0746219844796032 1.6274621867531285 3.4006239297824448 3.5631286642176478 1.2115756054574098 1.1023098772066122 -0.38107424264980061 -0.7073401634733405 -0.27108750762051903 0.18029893620142456 0.2566088491494205 2.3913871580897692 -0.10063282837544026 0.46733942021821195 -0.70188785782365948 -2.9428641277701093 -1.6040798671436034 -1.0944191458139179 -0.55948451166600499 1.0681606374658239 -3.5860611272721918 3.4512946589135267;-1.9103295832444438 -0.17961195318276044 1.0632673126418268 -0.084762052664245663 -0.78580310024248501 1.6706949876766057 -1.325804419145644 0.76042085617100486 -0.029888855315737164 -0.26912354236304237 -0.073843274971499492 0.25546181752396829 -0.071685634965547765 -0.38938168760800157 0.45446728424396615 0.78524906449448928 -0.86166294581556313 -0.29148164117834974 0.24144109120840218 -0.13331038415324342 0.036388461668710043 -0.058342277248009847 0.52688216576542701 -0.95799695117182249 0.086311432914943198 0.94193160279160382 -1.0151741914396459 0.64998267532789566 -0.39666725829289995 0.28300926806743226 -0.48624091299707195 0.60227897243532991 -0.45397329604137554 0.38773094384939338 -0.46553786625339955 0.92760699877125452 -0.45962751394440415 -0.081735813350247682 0.18531716503905329 0.60703672312458701 -0.92689457365803052 0.52210410015572062 0.050083779575765791 -0.41203406064270331 0.077670138706104175 0.075665209920608767 0.96847300108571532 -0.58516407278015548 0.2034257534169556 0.1142493505062161 -0.33920285104225784 0.59685271358591596 -0.28562670297549947 -0.38842786567166382 0.75705143342243941 0.10861911680019569 0.45454453199313072 -0.52038257305775959 0.26535732386818284 -0.52241590632958834 0.5728767769710662 -0.7377746385679983 0.76982860303611389 -0.20456044363056594 0.26963837436654292 -0.66612014273718079 1.0832424512172798 -1.0416381082629496 1.4216615625743367 -0.85746010092855163 0.014563619873371292 -0.086377452447802788;1.6710345286062831 -0.063176716462219312 0.25309077083877235 -0.43579103474653652 0.70963060804720213 0.31932297961203981 -0.70875089993353613 0.67317129674678877 3.4510000156611418 1.9917888396896257 0.10415525588762894 0.46516950556053804 0.29830902549574473 -3.1030156081903191 0.80609959861204472 -0.10988020995776768 0.15885787157242473 3.0393047312298638 3.5431888194091767 2.513551534074641 0.67399877608329806 -3.5338044412668199 -6.1913254673972382 -2.550429535915542 -2.1815261600518818 -1.7185295358364951 -0.025947146847822171 0.16968972096149745 1.9558789449255849 0.5446839334788236 -0.37778307618856244 0.25783864843598997 2.5053879636394343 1.0057989143397246 -0.89277517055197242 1.4346816702339384 1.4580907551496485 -0.49994591092721097 -1.7334999281486088 -3.328548287607672 -0.35295083164622426 0.76519114530615784 2.8267381310570623 3.4511087130642961 -1.2388563185696206 -0.17522976781425448 1.0112415106255177 1.51570815193777 1.5909578895581782 -0.24780279671972583 -1.8172851635199265 -1.1609259368087441 0.10867217608450574 -0.11667696993522716 1.29071032757396 2.8698384533395132 4.0532173281304811 3.7383720998215595 1.6769781377105621 1.9253514113266021 0.60329449476410102 -0.58306453585624884 -0.78564630832166304 -1.7421390211227878 0.29779247840158829 0.6182138106663243 3.8874558864896409 1.9639402865917488 -0.54098000399121648 -3.638973042949174 -3.5110754257093681 0.095908933723682685;-0.23928658922264678 -0.61225588875979198 -2.3012308565860264 1.9062925763777783 -1.7184668427993022 -0.7063449543388014 -0.87588515540853007 -0.22507554349275333 -0.025786993765933186 -0.44105612564747687 2.4932894200186575 -0.13787490612631031 1.889142865206179 0.050555528305548852 1.0751912154537866 0.26521864471299567 0.23588740846091238 -1.1379924413785463 1.9580498922727059 -1.5338582054472016 -3.644857885919043 -0.91810235333691914 -1.1313650629928824 -4.9066586279572331 -2.9448092696868238 1.0622274930324633 -0.38678118968230246 -2.8412545609175957 1.507205126961231 -1.2892651063733389 -0.60461618004019946 1.437590512541985 -1.9437704895494925 1.2629963506953916 -0.67338887386925528 -2.5182542042628442 -0.03721560887275023 1.1926817009576245 0.83263057584045974 -0.6834408707737063 0.39431361672611387 1.9836412173855842 2.3045351149581723 1.0279977778673473 -1.5247462993036203 -1.9598178002212348 2.4318914274041648 -0.20723136028361819 -0.5168537474606073 7.2045263746745665 2.7600654457991252 -1.9544121979326379 -2.596835134835239 -1.7190364648446161 -1.9109946807578635 -1.7547553605882868 -2.9023194489386013 -0.57393198105443843 -0.018404358063640686 0.067188206919750193 2.1934346040701906 -0.55718076962077245 -1.0129384340803558 1.4833578324323746 0.14791185180771699 -0.17661456723908961 1.5455188990418063 -3.0456099333025111 -0.32270358634866181 -0.30214416257317028 0.1304031019021841 1.3422984952062476;0.2410005577531163 -0.28630953135095732 1.3695146052954987 -2.0201523963243351 1.8514949246250885 -0.31467467792885018 -1.7420292297049722 0.66476075073038177 0.063053074488269689 0.72499630395120662 -1.0141092010044142 0.67810924558250218 -0.11830340518294069 0.44208625407554847 -0.02019685203045285 -2.8426810907291289 2.4045325983358574 3.1773545738164954 -0.93509621149357713 1.5570363377917049 -2.0769863355714024 1.9181647101609838 -3.059376043115456 1.7543167839542237 1.5167624431366959 -1.2837427567620123 2.3400419872088247 -2.3899151276633281 -3.4655218331110142 3.5708543577203047 -0.78187459113083846 -0.5116029398449029 0.88939934556496392 -1.5470841209664576 0.39160594561931639 0.87098115850085933 1.6818521098984536 -0.42653346301050299 -0.124331586643882 -1.6517068252795033 -2.8361479277242561 4.5374341544765642 0.28149454979661565 -1.5007020571277843 -0.64484026325605148 -1.1131116216330836 2.9980287806598369 -5.5141358325801129 1.9477703569798421 -3.3959887536625297 2.9041036477527009 -1.5509976194220778 6.1619728854866587 -7.0737638477270055 1.1332185396512389 0.10717486510626251 1.0408117331283175 0.087830765030103036 -0.87045739278237977 0.49136021603446595 -0.031852316349579246 -0.92815747102342239 2.2718243234540805 -3.3938887632018764 0.077097173850007139 -0.57559618433136361 0.59788981152168863 -0.62670481212360141 -3.4355863362826247 0.090877282878264576 4.8217151991374356 -1.1923882935934169;-8.7862430642608569 -0.050281223734548047 4.373596805093384 -4.1952682793265739 0.2377539537183769 3.9702557018417046 -2.5786002645568362 -1.9406865963055466 -1.2168696708484488 1.2924717983399456 -0.025248016438619868 0.29210187415696542 2.0537161172899987 0.57644301053397917 -0.33219597919265392 -0.83753509666958614 -2.4991331744648932 2.9230567451597631 1.5112683153936037 4.4009513985357467 0.31553220195012299 -3.0706983751790333 0.26001416530728544 1.5292134716848023 -1.7427511603252859 1.6055572324697271 2.0806369504310092 -1.8360672332131092 2.7567592003868548 5.4633020336131901 1.8894549619158378 -1.4969111356534808 1.4516273134473547 2.3869048238242359 -0.15379329054945629 -1.0920909760851598 -0.66052883708171606 -0.41785347317106253 -1.1182989423654033 -0.71585939137963239 -0.65923924658498123 5.3528315853624102 -1.1061852087257649 -1.3027048982260436 5.1503275779044939 1.5192467298740677 0.88113379530940517 -0.83524518985094787 3.2461210421604201 3.5845208899624406 -3.5426655607940076 -3.604225624473917 0.82500643231084125 0.6400143724771008 -2.6235248731045555 -0.64314311769803845 0.99850061144194324 -1.0728337153331913 -1.5981926203575323 0.26375193457281232 1.1323910558806096 1.4043160076524146 0.97113229965975723 0.25757587896405382 -0.33683701547813494 1.7518357365701565 2.1509538913982773 2.8119839298642146 -0.92266337364091 -4.3627141871352269 -6.3958946787100706 -1.3425558092866898;-3.6808630376618394 -4.0054890284227866 -2.2122335509283726 -2.5633204891961965 -3.8617111803194142 -1.2575110036229047 2.2775670977850107 2.2017495621335499 1.8032735991513598 0.5779031352398396 1.7160845024507088 2.0145734028905165 1.4656250895999314 0.40478242211704024 -0.06647822136590345 -0.98424053603036432 -0.95908585747856634 -0.51088391861615379 -1.6153380774523396 -2.9513698210803692 -2.6488885230350263 -1.1193237320936062 1.5565876966074612 2.1997383393891607 4.3609023313108208 3.6310456789676726 1.8710587585123 0.70575878355883437 -1.7731348868489873 -1.8350014678099968 1.0636338341849125 1.022519202664242 1.0209607155946454 0.91347616105702811 1.7418719426606828 2.3843141926374614 0.70938975550022487 0.030713920417548432 -0.90959745429764371 0.40303295681844287 -0.023301342151055268 -0.069072713674037112 -0.88818016668728195 -2.3995575929724731 -0.44011337383255822 -0.33726536103021554 0.47605622361674621 0.17155906753610464 1.3973362366218123 1.8627229790964712 -0.45230754359663794 -1.7547813957919698 -2.5639578669239707 0.24324107544872614 -0.74444334641160759 0.4622297307761713 -0.49965675716092195 0.11053574213120057 0.31959421610705979 1.2574539643612859 1.3819363561150289 1.0591078089386337 -0.73114420527278345 0.15630098765826711 0.70667693749811811 -1.3897952550045105 -1.8843847634586013 -1.4200809148293898 -1.2240298662376958 -0.5805884959550579 -0.41986469445127728 0.4881092688223983];
  
  % Layer 2
  b2 = -0.0563832526548049;
  LW2_1 = [0.046201893453249605 0.21564697516768314 0.10053555672235871 0.026017772244068975 -0.71473974116166439 0.009760730751316421 -0.019739505117445384 -0.059665893659946317 0.00023319945252425062 -0.023199851576837113];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = 0.0832466181061394;
  y1_step1_xoffset = 0;
  
  % ===== SIMULATION ========
  
  % Dimensions
  TS = size(x1,2); % timesteps
  
  % Input 1 Delay States
  xd1 = mapminmax_apply(xi1,x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
  xd1 = [xd1 zeros(1,1)];
  
  % Allocate Outputs
  y1 = zeros(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Rotating delay state position
    xdts = mod(ts+71,73)+1;
  
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72]-1,73)+1),72,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final delay states
  finalxts = TS+(1: 72);
  xits = finalxts(finalxts<=72);
  xts = finalxts(finalxts>72)-72;
  xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
