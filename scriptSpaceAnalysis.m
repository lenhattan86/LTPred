% Reset
clc; clear; close all;    
% Add class paths
addpath('functions');

GMT = [-6 -5 -6 -5 -6 -8 -5];

timeZone1 = 1:5;
timeZone2 = 6:7;

fontAxis = 14;
fontTitle = 14;
fontLegend = 14;
LineWidth = 2;
FontSize = 14;

figPath = 'C:\Users\NhatTan\Dropbox\Research-Tan\SharedManuscript\figs\';
% figPath = '';
dataType = 'solar';
% dataType = 'wind'; 
% dataType = 'price'; 
% dataType = 'workload';

%% Load data
path_ar_solar_24_q_7_30 = 'google_dc/errors/AR/SOLAR/'; 
files_ar_solar_24_q_7_30 = [
         'AL_34.65_-86.783_2007_2009.csv_24_q_7_30 '; ...
         'GA_33.65_-84.433_2007_2009.csv_24_q_7_30 '; ...
         'IA_41.017_-94.367_2007_2009.csv_24_q_7_30'; ...
         'NC_35.733_-81.383_2007_2009.csv_24_q_7_30'; ...
         'OK_36.2_-95.883_2007_2009.csv_24_q_7_30  '; ...
         'OR_45.55_-122.4_2007_2009.csv_24_q_7_30  ' ; ...
         'SC_33.967_-80.467_2007_2009.csv_24_q_7_30'; ...
         ];
     
path_ar_solar_24_q_7_30_others = 'google_dc/errors/AR/SOLAR/'; 
solar_timezone = [3 4 3 4 3 1 4 1 4 3 3 4 3 3 4 4 3 2  1];
files_ar_solar_24_q_7_30_others = [
         'AL_34.65_-86.783_2007_2009.csv_24_q_7_30 '; ...
         'GA_33.65_-84.433_2007_2009.csv_24_q_7_30 '; ...
         'IA_41.017_-94.367_2007_2009.csv_24_q_7_30'; ...
         'NC_35.733_-81.383_2007_2009.csv_24_q_7_30'; ...
         'OK_36.2_-95.883_2007_2009.csv_24_q_7_30  '; ...
         'OR_45.55_-122.4_2007_2009.csv_24_q_7_30  ' ; ...
         'SC_33.967_-80.467_2007_2009.csv_24_q_7_30'; ...
         ...
         'CA_037.00_-120.00_2007_2009.csv_24_q_7_30' ;...
         'FL_027.77_-081.69_2007_2009.csv_24_q_7_30' ;...
         'ND_047.53_-099.78_2007_2009.csv_24_q_7_30' ;...
         'NE_041.13_-098.27_2007_2009.csv_24_q_7_30' ;...
         'NY_042.17_-074.95_2007_2009.csv_24_q_7_30' ;...
         'TX_031.05_-097.56_2007_2009.csv_24_q_7_30' ;...
         'LA_31.17_-91.87_2007_2009.csv_24_q_7_30  ' ;...
         'ME_44.69_-69.38_2007_2009.csv_24_q_7_30  ' ;...
         'MI_43.33_-84.54_2007_2009.csv_24_q_7_30  ' ;...
         'MO_38.46_-92.29_2007_2009.csv_24_q_7_30  ' ;...
         'WY_42.76_-107.3_2007_2009.csv_24_q_7_30  ' ;...
         'WA_047.40_-121.49_2007_2009.csv_24_q_7_30'];     
      

path_ar_wind_24_q_7_30   = 'google_dc/errors/AR/WIND/'; 
files_ar_wind_24_q_7_30  = [
         'AL_34.65_-86.783_merge.csv_24_q_7_30 '; ...AL_34.65_-86.783_merge.csv_30
         'GA_33.65_-84.433_merge.csv_24_q_7_30 '; ...
         'IA_41.017_-94.367_merge.csv_24_q_7_30'; ...
         'NC_35.733_-81.383_merge.csv_24_q_7_30'; ...
         'OK_36.2_-95.883_merge.csv_24_q_7_30  '; ...
         'OR_45.55_-122.4_merge.csv_24_q_7_30  ' ; ...
         'SC_33.967_-80.467_merge.csv_24_q_7_30'; ...         
         ];     

wind_timezone = [3 4 3 4 3 1 4 1 4 3 3 4 3 3 4 4 3 2 1];
path_ar_wind_24_q_7_30_others = 'google_dc/errors/AR/WIND/';  
files_ar_wind_24_q_7_30_others = [
         'AL_34.65_-86.783_merge.csv_24_q_7_30 ' ; ...AL_34.65_-86.783_merge.csv_30
         'GA_33.65_-84.433_merge.csv_24_q_7_30 ' ; ...
         'IA_41.017_-94.367_merge.csv_24_q_7_30' ; ...
         'NC_35.733_-81.383_merge.csv_24_q_7_30' ; ...
         'OK_36.2_-95.883_merge.csv_24_q_7_30  ' ; ...
         'OR_45.55_-122.4_merge.csv_24_q_7_30  ' ; ...
         'SC_33.967_-80.467_merge.csv_24_q_7_30' ; ...
         
         'CA_037.00_-120.00_merge.csv_24_q_7_30' ; ...
         'FL_027.77_-081.69_merge.csv_24_q_7_30' ; ...
         'ND_047.53_-099.78_merge.csv_24_q_7_30' ; ...
         'NE_041.13_-098.27_merge.csv_24_q_7_30' ; ...
         'NY_042.17_-074.95_merge.csv_24_q_7_30' ; ...
         'TX_031.05_-097.56_merge.csv_24_q_7_30' ; ...
         'LA_31.17_-91.87_merge.csv_24_q_7_30  ' ; ...
         'ME_44.69_-69.38_merge.csv_24_q_7_30  ' ; ...
         'MI_43.33_-84.54_merge.csv_24_q_7_30  ' ; ...
         'MO_38.46_-92.29_merge.csv_24_q_7_30  ' ; ...
         'WY_42.76_-107.3_merge.csv_24_q_7_30  ' ; ...
         'WA_047.40_-121.49_merge.csv_24_q_7_30'   ...
         ];    
                  
price_timezone = [1  2 2 2   3 3 3 3 3 3    4 4 4 4 4 4   5 5 5 5];
path_ar_price_24_q_7_30 = 'prices/errors/AR/'; 
files_ar_price_24_q_7_30  = [ 
                            'price_0029.76_-095.36_tx.houston.csv_24_q_7_30' ...
                            
                          ; 'price_0037.34_-121.91_ca.np15.csv_24_q_7_30   ' ...
                          ; 'price_0033.97_-118.25_ca.sp15.csv_24_q_7_30   ' ...
                          ; 'price_0034.92_-120.23_ca.zp26.csv_24_q_7_30   ' ...
                          
                          ; 'price_0040.75_-074.00_ny.nyc.csv_24_q_7_30    ' ...
                          ; 'price_0042.65_-073.76_ny.capitl.csv_24_q_7_30 ' ...
                          ; 'price_0044.54_-073.62_ny.north.csv_24_q_7_30  ' ...
                          ; 'price_0040.75_-074.00_ny.nyc.csv_24_q_7_30    ' ...
                          ; 'price_0040.52_-074.42_ny.pjm.csv_24_q_7_30    ' ...
                          ; 'price_0042.89_-078.89_ny.west.csv_24_q_7_30   ' ...
                          
                          ; 'price_0041.85_-087.63_pjm.chi.csv_24_q_7_30   ' ...
                          ; 'price_0039.66_-082.01_pjm.ohio.csv_24_q_7_30  ' ...
                          ; 'price_0039.94_-083.31_pjm.aep.csv_24_q_7_30   ' ...
                          ; 'price_0040.54_-074.40_pjm.nj.csv_24_q_7_30    ' ...                                                    
                          ; 'price_0037.56_-077.46_pjm.dom.csv_24_q_7_30   ' ...
                          ; 'price_0039.10_-075.62_pjm.east.csv_24_q_7_30  ' ...

                          ; 'price_0042.36_-071.06_ne.bos.csv_24_q_7_30    ' ... 
                          ; 'price_0043.65_-070.26_ne.mn.csv_24_q_7_30     ' ...
                          ; 'price_0043.23_-071.56_ne.nh.csv_24_q_7_30     ' ...
                          ; 'price_0044.26_-072.57_ne.vt.csv_24_q_7_30     ' ...
                      ];     
                  
workload_timezone = [3 4 3   3 1 4   4 3 3  4   1  3   3 4 3 3 4    3 2 1];
path_ar_workload_24_q_7_1 = 'workload/errors/AR/'; 
files_ar_workload_24_q_7_1 = [ 'AL_0034.77_-086.68_workload.csv_24_q_7_1 ' ...
                          ; 'GA_0033.72_-084.47_workload.csv_24_q_7_1 ' ...
                          ; 'IA_0041.58_-093.68_workload.csv_24_q_7_1 ' ...

                          ; 'OK_0035.48_-097.50_workload.csv_24_q_7_1 ' ...
                          ; 'OR_0044.81_-122.68_workload.csv_24_q_7_1 ' ...
                          ; 'SC_0034.07_-081.19_workload.csv_24_q_7_1 ' ... 
                          
                          ; 'VA_0038.02_-078.57_workload.csv_24_q_7_1 ' ...   
                          ; 'TN_0036.07_-086.72_workload.csv_24_q_7_1 ' ...   
                          ; 'AR_0034.57_-092.64_workload.csv_24_q_7_1 ' ... 
                          
                          ; 'MA_0042.35_-071.55_workload.csv_24_q_7_1 ' ...   
                          
                          ; 'CA_0037.28_-120.45_workload.csv_24_q_7_1 ' ...   
%                           ; 'FL_0027.93_-082.37_workload.csv_24_q_7_1 ' ...   
                          ; 'ND_0046.97_-097.99_workload.csv_24_q_7_1 ' ...   
                          
                          ; 'NE_0040.80_-096.67_workload.csv_24_q_7_1 ' ...   
                          ; 'NY_0041.59_-075.54_workload.csv_24_q_7_1 ' ...   
                          ; 'TX_0031.11_-097.73_workload.csv_24_q_7_1 ' ...   
                          
                          ; 'LA_0030.53_-091.12_workload.csv_24_q_7_1 ' ...   
                          ; 'ME_0044.85_-068.83_workload.csv_24_q_7_1 ' ...   
%                           ; 'MI_0043.58_-084.35_workload.csv_24_q_7_1 ' ...   
                          
                          ; 'MO_0038.90_-092.24_workload.csv_24_q_7_1 ' ...   
                          ; 'WY_0043.10_-108.94_workload.csv_24_q_7_1 ' ...   
                          ; 'WA_0047.57_-121.78_workload.csv_24_q_7_1 ' ...   
                      ];   
     
%%
legendStr = {'same time zone','different time zone', 'fitted'};
isFit = 1;

if strcmp(dataType,'solar')
    path = path_ar_solar_24_q_7_30_others; files =  files_ar_solar_24_q_7_30_others; timeZones =  solar_timezone;
elseif strcmp(dataType,'wind')
    path = path_ar_wind_24_q_7_30_others; files =  files_ar_wind_24_q_7_30_others; timeZones =  wind_timezone;
elseif strcmp(dataType,'price')
    path = path_ar_price_24_q_7_30	; files =  files_ar_price_24_q_7_30;
    timeZones =  price_timezone; legendStr = {'same RTO','different RTO', 'fitted'};
elseif strcmp(dataType,'workload')
    path = path_ar_workload_24_q_7_1; files =  files_ar_workload_24_q_7_1; timeZones = workload_timezone;  isFit = 0;
end

filesCell = cellstr(files);
numOfFile = length(files(:,1));

%errorsArray;
LatArrays = zeros(1,numOfFile);
LonArrays = zeros(1,numOfFile);
for i=1:numOfFile
    load(strcat(path,files(i,:),'.mat'));
    LatArrays(i) = Lat;
    LonArrays(i) = Lon;
%     errors = circshift(errors, -GMT(i));
    errorArray(i,:) = errors;
    
end

%%
DATA_LENGTH = length(errorArray(1,:));
% Calculate the distance between each pair of PV plant.
%pvDistances = zeros(numOfFile);
iIndex = 0;
isSameTimeZone = false(numOfFile*(numOfFile+1)/2, 1);
for iRow = 1:numOfFile
    for iCol = 1:iRow
        iIndex = iIndex + 1;  
        [pvDistances(iIndex) x] = lldistkm([LatArrays(iRow), LonArrays(iRow)],[LatArrays(iCol), LonArrays(iCol)]);  
        if timeZones(iRow)==timeZones(iCol);
            isSameTimeZone(iIndex) = true;
        end
    end
end

%% Calculate the correlation of in space domain.
%corrCofficients = corrcoef(deltasMatrix);
iIndex = 0;
%corrList = zeros(numOfFile);
for iRow = 1:numOfFile
    for iCol = 1:iRow
        iIndex = iIndex + 1;
        corrList(iIndex) = corr(errorArray(iRow,:)', errorArray(iCol,:)');          
    end
end
figure1 = figure;
axes1 = axes('Parent',figure1);
legend('same time zone');

scatter(pvDistances(isSameTimeZone), corrList(isSameTimeZone),'MarkerEdgeColor','blue','MarkerFaceColor','blue');
hold on;
scatter(pvDistances(~isSameTimeZone), corrList(~isSameTimeZone),'x','MarkerEdgeColor','red');

% xlabel('Distance (km)');
% ylabel('Correlation coefficient');
% axis([0 max(pvDistances) -0.4 1 ]);
% hold on;

if isFit 
    [fitresult, gof] = getRationalCurve(pvDistances, corrList);
    hold on;
    xData = 0:max(pvDistances);
    plot(xData, fitresult(xData),'-k', 'linewidth', 1.5);    
end
legend(legendStr);

% Label axes
axis([0 5000 -0.3 1.2 ]);
set(gca, 'fontsize',fontAxis);
legend(legendStr,'Location','northeast','FontSize',fontLegend,'Orientation','vertical');
set (gcf, 'PaperUnits', 'inches', 'PaperPosition', [0.1 0 4.0 3.0]);
xlabel('distance (km)','FontSize',fontAxis);
ylabel('correlation coefficient','FontSize',fontAxis);
print ('-depsc', [figPath dataType '_ar_corr_coff'  '.eps']);
